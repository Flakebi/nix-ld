From 007e8052d8b3b2daa024988e102909363e271cfe Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?J=C3=B6rg=20Thalheim?= <joerg@thalheim.io>
Date: Sun, 17 Jan 2021 08:17:04 +0100
Subject: [PATCH] ignore tls section in static binaries
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This leads to crashes in nix-ld.

Signed-off-by: JÃ¶rg Thalheim <joerg@thalheim.io>
---
 src/env/__init_tls.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/env/__init_tls.c b/src/env/__init_tls.c
index a93141ed..6dac5221 100644
--- a/src/env/__init_tls.c
+++ b/src/env/__init_tls.c
@@ -93,7 +93,7 @@ static void static_init_tls(size_t *aux)
 			base = aux[AT_PHDR] - phdr->p_vaddr;
 		if (phdr->p_type == PT_DYNAMIC && _DYNAMIC)
 			base = (size_t)_DYNAMIC - phdr->p_vaddr;
-		if (phdr->p_type == PT_TLS)
+		if (0 && phdr->p_type == PT_TLS)
 			tls_phdr = phdr;
 		if (phdr->p_type == PT_GNU_STACK &&
 		    phdr->p_memsz > __default_stacksize)
-- 
2.30.0

